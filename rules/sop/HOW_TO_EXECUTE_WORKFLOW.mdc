---
description: "Operational Protocol: Configuring and triggering workflow execution. State-based guidance for setting parameters and starting a workflow run."
globs: []
alwaysApply: false
---

# Protocol: Execute Workflow

**Purpose:** Guide the user through configuring workflow parameters and triggering execution.

**Prerequisites:**
- User is on `/workflow-execute/:id` page (or navigating there)
- Workflow has been selected for execution
- Workflow is in configuring state (`?state=configuring`)

---

## State Machine Overview

```
EXPLAIN â†’ CONFIGURE â†’ EXECUTE
    â†‘         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (if parameters need adjustment)
```

---

## Planning

This protocol is multi-step and stateful. When it is loaded, your **next assistant message must include a plan** before any tool call.

Output the plan as a single JSON object in a `json` code block, using:
- `goal`, `current_state`, `steps`, `decision_points`, `verification`
- step `status`: `todo` | `doing` | `done` | `blocked`

Example:

```json
{
  "goal": "Execute a workflow run",
  "current_state": {
    "page": "/workflow-execute/â€¦?state=configuring",
    "workflow_id": "â€¦"
  },
  "steps": [
    {"id": "EXPLAIN", "status": "doing"},
    {"id": "CONFIGURE", "status": "todo"},
    {"id": "EXECUTE", "status": "todo"}
  ],
  "decision_points": [
    "Collect required parameter values from the user",
    "Confirm before starting execution if the run is impactful"
  ],
  "verification": [
    "After EXECUTE, the UI reports the run started successfully (or shows a clear error)"
  ]
}
```

Update this plan as you progress (mark statuses, add brief notes).

---

## State: EXPLAIN

### Indicators
- User has arrived at the execution page
- They may not understand what this workflow does
- Parameters have not been reviewed yet

### Context Check
```
page.full_path: Should be "/workflow-execute/*"
workflow.title: Name of the workflow
workflow.description: What it does
form_schema: Array of parameters the workflow accepts
```

### Goal
Help the user understand what this workflow does before configuring it.

### Actions

**1. Read workflow details from context:**
- `workflow.title` - What this workflow is called
- `workflow.description` - Detailed explanation
- `form_schema` - Parameters it accepts

**2. Explain to the user:**

```
ðŸ“‹ **Workflow:** [title]

**Purpose:** [description]

**Parameters this workflow needs:**
[List parameters from form_schema with their types]
```

**3. Check if parameters are required:**

If `form_schema` is empty or all parameters have defaults:
- Workflow can run immediately
- Offer to execute or let user review

### Transitions
- Parameters need values â†’ **CONFIGURE**
- No parameters required â†’ **EXECUTE**
- User wants to understand more â†’ Remain in **EXPLAIN**

---

## State: CONFIGURE

### Indicators
- Workflow has parameters that need values
- User needs to provide input
- `form_schema` contains required fields

### Context Check
```
form_schema: [
  { "name": "param1", "type": "string", "required": true },
  { "name": "param2", "type": "number", "required": false, "default": 10 }
]
current_values: Current parameter values (if any set)
```

### Goal
Collect all required parameter values from the user or set defaults.

### Actions

**1. Identify what's needed:**

For each parameter in `form_schema`:
- Is it required? (`required: true`)
- What type is expected? (string, number, boolean, object, array)
- Is there a default? (`default` field)
- What's it for? (`description` field)

**2. Ask user for required values:**

```
This workflow needs the following parameters:

**Required:**
- `email_address` (string): The recipient email

**Optional:**
- `max_results` (number, default: 10): How many results to return

Please provide the required values.
```

**3. Set parameters:**

```
TOOL_CALL: {"name": "ui_fill_state", "parameters": {"store_id": "workflow", "updates": {"workflowParams": {"param_name_1": "value", "param_name_2": 42}}}}
```

**4. Verify parameters are set:**

Check `current_values` in next context to confirm values were applied.

### Type Reference

| Type | Example Value | Notes |
|------|---------------|-------|
| `string` | `"hello"` | Text value, use quotes |
| `number` | `42` or `3.14` | No quotes, can be decimal |
| `boolean` | `true` or `false` | No quotes |
| `object` | `{"key": "value"}` | Nested structure |
| `array` | `["a", "b", "c"]` | List of values |

### Transitions
- All required parameters set â†’ **EXECUTE**
- User provides values â†’ Set them and verify
- Validation error â†’ Check `validation_error` in context, fix and retry

---

## State: EXECUTE

### Indicators
- All required parameters are set
- Workflow is ready to run
- Execute button should be available

### Context Check
```
elements: Must include execute button (exact ID varies)
current_values: All required parameters should have values
validation_error: Should be null/empty
```

### Goal
Trigger workflow execution.

### Actions

**1. Verify ready to execute:**

Check that:
- All required parameters have values
- No validation errors in context
- Execute button is available in elements

**2. Confirm with user (optional but recommended):**

```
Ready to execute **[workflow.title]** with:
- param1: value1
- param2: value2

Shall I start the execution?
```

**3. Trigger execution:**

```
TOOL_CALL: {"name": "ui_trigger_click", "parameters": {"element_id": "[EXECUTE_WORKFLOW_BUTTON_ID]"}}
```

**4. Inform user what happens next:**

```
ðŸš€ Workflow execution started!

The page will show execution progress. I cannot take actions while the workflow is running, but I'll help interpret the results when it completes.
```

### Transitions
- Execution started â†’ End of this protocol. The page will transition to `state=executing` (no SOP is loaded while running). When it reaches `state=complete`, `HOW_TO_DEBUG_WORKFLOW` will load automatically.
- Execution failed to start â†’ Check error, return to **CONFIGURE**

---

## Reference: Common Parameter Patterns

### String Parameter
```json
{
  "name": "email",
  "type": "string",
  "required": true,
  "description": "Recipient email address"
}
```
Set with: `{"email": "user@example.com"}`

### Number Parameter
```json
{
  "name": "limit",
  "type": "number",
  "required": false,
  "default": 10
}
```
Set with: `{"limit": 25}` (no quotes around number)

### Boolean Parameter
```json
{
  "name": "include_details",
  "type": "boolean",
  "required": false,
  "default": false
}
```
Set with: `{"include_details": true}` (no quotes)

### Object Parameter
```json
{
  "name": "filters",
  "type": "object",
  "required": false
}
```
Set with: `{"filters": {"status": "active", "limit": 10}}`

---

## Common Pitfalls

1. **Executing without required parameters**: Will failâ€”always check `form_schema` for `required: true`.

2. **Wrong parameter types**: `"42"` (string) is not `42` (number). Match the expected type.

3. **Trying to monitor progress**: Agent cannot take action during executionâ€”just wait.

4. **Forgetting defaults**: Optional parameters with defaults don't need values unless user wants different.

5. **Not verifying parameter values**: After setting, check `current_values` to confirm they were applied.

6. **Interpreting results on this page**: Results interpretation uses the `HOW_TO_DEBUG_WORKFLOW` protocol, not this one.
